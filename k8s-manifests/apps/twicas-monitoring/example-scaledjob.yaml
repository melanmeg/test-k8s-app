apiVersion: keda.sh/v1alpha1
kind: ScaledJob
metadata:
  name: example-scaledjob
spec:
  jobTargetRef:
    template:
      spec:
        containers:
          - name: example-job-container
  envSourceContainerName: example-job-container
  successfulJobsHistoryLimit: 2 # 完了したジョブの履歴の保持数
  failedJobsHistoryLimit: 2 # 失敗したジョブの履歴の保持数
  triggers:
    - type: rabbitmq
      metadata:
        host: amqp://admin:admin@rabbitmq-cluster.rabbitmq:5672/
        protocol: auto
        mode: QueueLength # キュー内のメッセージ数でスケーリング
        value: "1" # キューに1メッセージが追加されるごとに Pod を1つ増加させる
        activationValue: "1" # 初期のアクティベーション値
        queueName: my_queue
        vhostName: /
        unsafeSsl: "true"
